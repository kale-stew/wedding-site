"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[359],{3033:function(e,r,t){var n=t(5893);r.Z=function(){return(0,n.jsx)("div",{children:"Loading..."})}},3369:function(e,r,t){var n=t(5893),i=t(4642),o=t(1310);r.Z=function(e){var r=e.guestType,t=(0,i.E)(),a=t.loadingState,s=t.login;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("form",{onSubmit:function(e){e.preventDefault(),s(e.target[0].value,r)},children:[r," Log in:",(0,n.jsx)("input",{type:"password",placeholder:"password"})]}),a.includes(o.Vu.ERROR)&&(0,n.jsx)("p",{children:"Error attempting to log in, please try again."})]})}},7729:function(e,r,t){t.d(r,{Z:function(){return P}});var n=t(5893),i=t(4642),o=t(4051),a=t.n(o),s=t(9267),u=t(1310),l=t(3454);function d(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function c(e,r,t,n,i,o,a){try{var s=e[o](a),u=s.value}catch(l){return void t(l)}s.done?r(u):Promise.resolve(u).then(n,i)}function v(e){return function(){var r=this,t=arguments;return new Promise((function(n,i){var o=e.apply(r,t);function a(e){c(o,n,i,a,s,"next",e)}function s(e){c(o,n,i,a,s,"throw",e)}a(void 0)}))}}function p(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(!e)return;if("string"===typeof e)return d(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return d(e,r)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}u.ze.ASSOCIATION,u.ze.CHILD_1,u.ze.CHILD_2,u.ze.CITY;var f=u.ze.EMAIL,m=u.ze.FIRST_NAME,h=u.ze.HASH,g=u.ze.ID,b=u.ze.LAST_NAME,N=(u.ze.NUM_ADULTS,u.ze.NUM_CHILDREN,u.ze.PARTNER_FIRST_NAME),x=u.ze.PARTNER_LAST_NAME,y=(u.ze.SENT_ANNOUNCEMENT,u.ze.STATE,u.ze.STREET_ADDRESS),E=(u.ze.STREET_ADDRESS_2,u.ze.THANK_YOU,u.ze.TOTAL_IN_PARTY,u.ze.TYPE),T=u.ze.WEBSITE_VISITS,S=[{property:"Last Name",direction:"ascending"}],w=new s.KU({auth:l.env.NOTION_ACCESS_TOKEN,logLevel:s.in.DEBUG}),_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.env.WEDDING_GUESTS_DATABASE_ID,n={database_id:t};return null!=e&&(n.start_cursor=e),null!=r&&(n.page_size=r),n},A=function(e){if(null!==e)switch(e.type){case"rich_text":var r;return(null===e||void 0===e?void 0:e.rich_text.length)>0?null===(r=null===e||void 0===e?void 0:e.rich_text[0])||void 0===r?void 0:r.plain_text:"";case"email":return(null===e||void 0===e?void 0:e.email)?e.email:null;case"number":return(null===e||void 0===e?void 0:e.number)?null===e||void 0===e?void 0:e.number:0;case"multi_select":return null===e||void 0===e?void 0:e.multi_select;case"title":return(null===e||void 0===e?void 0:e.title.length)>0?e.title[0].plain_text:"";case"formula":return function(e){var r;switch(null===e||void 0===e||null===(r=e.formula)||void 0===r?void 0:r.type){case"string":var t;return null===e||void 0===e||null===(t=e.formula)||void 0===t?void 0:t.string;case"number":var n;return null===e||void 0===e||null===(n=e.formula)||void 0===n?void 0:n.number;default:return console.warn("\ud83d\udc4b ".concat(e.formula.type," doesn't evaluate to a string or number. We need to update the formatFormulaType fn \u2192 notion.js  ")),null}}(e);default:return"Default"}return null},j=function(){var e=v(a().mark((function e(){var r,t,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=_()).sorts=S,e.next=4,w.databases.query(r);case 4:t=e.sent,n=p(t.results);case 6:if(!t.has_more){e.next=15;break}return(i=_(t.next_cursor)).sorts=S,e.next=11,w.databases.query(i);case 11:t=e.sent,n=p(n).concat(p(t.results)),e.next=6;break;case 15:return e.abrupt("return",n.map((function(e){return{email:A(null===e||void 0===e?void 0:e.properties[f]),firstName:A(null===e||void 0===e?void 0:e.properties[m]),hash:A(null===e||void 0===e?void 0:e.properties[h]),id:A(null===e||void 0===e?void 0:e.properties[g]),lastName:A(null===e||void 0===e?void 0:e.properties[b]),notionId:null===e||void 0===e?void 0:e.id,partnerFirstName:A(null===e||void 0===e?void 0:e.properties[N]),partnerLastName:A(null===e||void 0===e?void 0:e.properties[x]),streetAddress:A(null===e||void 0===e?void 0:e.properties[y]),websiteVisits:A(null===e||void 0===e?void 0:e.properties[T]),guestType:A(null===e||void 0===e?void 0:e.properties[E])}})));case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=(function(){var e=v(a().mark((function e(r){var t,n,i,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:if(t=e.sent,!(null===(n=t.find((function(e){return e.id===r})))||void 0===n?void 0:n.notionId)){e.next=12;break}return i=1+n.websiteVisits,e.next=8,w.pages.update({page_id:n.notionId,properties:(a={},s=T,u={number:i},s in a?Object.defineProperty(a,s,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[s]=u,a)});case 8:return o=e.sent,e.abrupt("return",o);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}var a,s,u}),e)})))}(),t(1876).Buffer),k=t(3454);function I(e,r,t,n,i,o,a){try{var s=e[o](a),u=s.value}catch(l){return void t(l)}s.done?r(u):Promise.resolve(u).then(n,i)}function L(e){return function(){var r=this,t=arguments;return new Promise((function(n,i){var o=e.apply(r,t);function a(e){I(o,n,i,a,s,"next",e)}function s(e){I(o,n,i,a,s,"throw",e)}a(void 0)}))}}var O=t(2418),D=t(9704),R=u.WU.POST,U=(function(){var e=L(a().mark((function e(r,t){var n,i,o,s,u,l,d,c,v,p,f,m,h,g,b,N,x,y,E;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.method!==R||!(null===(n=r.headers)||void 0===n?void 0:n.authorization)){e.next=31;break}return e.prev=2,s=null===(i=JSON.parse(r.body))||void 0===i?void 0:i.component,u=new z.from(null===(o=r.headers)||void 0===o?void 0:o.authorization.split(" ")[1],"base64").toString("ascii"),e.next=8,j();case 8:l=e.sent,d=0;case 10:if(!(d<l.length)){e.next=24;break}if(!O.compareSync(u,l[d].hash)){e.next=21;break}if(c=l[d],v=c.email,p=c.firstName,f=c.id,m=c.lastName,h=c.partnerFirstName,g=c.partnerLastName,b=c.streetAddress,N=c.websiteVisits,x=c.guestType,y={email:v,firstName:p,id:f,lastName:m,partnerFirstName:h,partnerLastName:g,streetAddress:b,websiteVisits:N,guestType:x},u=void 0,x.map((function(e){return e.name})).includes(s)){e.next=19;break}return e.abrupt("return",t.status(401).json({error:"Unauthorized, logging in as wrong guest type."}));case 19:return E=U(y),e.abrupt("return",t.json({accessToken:E,guest:y}));case 21:d++,e.next=10;break;case 24:return e.abrupt("return",t.status(401).json({error:"Unauthorized, incorrect password."}));case 27:return e.prev=27,e.t0=e.catch(2),console.error("Error Logging in:",e.t0),e.abrupt("return",t.status(500).send({error:"Server Error when logging in."}));case 31:return e.abrupt("return",t.status(400).json({message:"login only allows POST"}));case 32:case"end":return e.stop()}}),e,null,[[2,27]])})))}(),function(){var e=L(a().mark((function e(r,t){var n,i,o,s,u,l,d,c,v,p,f,m,h,g,b,N,x,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=C(null===(n=JSON.parse(r.body))||void 0===n?void 0:n.token),s=null===(i=JSON.parse(r.body))||void 0===i?void 0:i.component,!(null===o||void 0===o?void 0:o.data)){e.next=20;break}return e.next=7,j();case 7:if(u=e.sent,l=!1,d=u.find((function(e){var r,t,n=e.guestType.map((function(e){return e.name}));return e.id!==(null===(r=o.data)||void 0===r?void 0:r.id)||n.includes(s)?e.id===(null===(t=o.data)||void 0===t?void 0:t.id):(l=!0,!1)})),!l){e.next=12;break}return e.abrupt("return",t.status(401).json({error:"Unauthorized, logging in as wrong guest type."}));case 12:if(d){e.next=14;break}return e.abrupt("return",t.status(401).json({error:"Unauthorized, guest not found"}));case 14:return c=d.email,v=d.firstName,p=d.id,f=d.lastName,m=d.partnerFirstName,h=d.partnerLastName,g=d.streetAddress,b=d.websiteVisits,N=d.guestType,y=U(x={email:c,firstName:v,id:p,lastName:f,partnerFirstName:m,partnerLastName:h,streetAddress:g,websiteVisits:b,guestType:N}),e.abrupt("return",t.json({guest:x,accessToken:y}));case 20:return e.abrupt("return",t.status(401).json({error:"Unauthorized: Invalid token"}));case 21:e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(0),console.error("Error logging in with id:",e.t0),e.abrupt("return",t.status(500).json({error:"Server error logging in with id"}));case 27:case"end":return e.stop()}}),e,null,[[0,23]])})))}(),function(e){return D.sign({data:e,exp:Math.floor(Date.now()/1e3)+u.W2},k.env.TOKEN_SECRET)}),C=function(e){return D.verify(e,k.env.TOKEN_SECRET,(function(e,r){var t;if(e)return console.error("Error verifying with jwt. ".concat(e)),"TokenExpiredError"===(null===e||void 0===e?void 0:e.name)&&(console.error("Error token expired"),!1);if((null===r||void 0===r?void 0:r.data)&&(null===(t=r.data)||void 0===t?void 0:t.firstName)){var n=Math.floor(Date.now()/1e3);return!(!(null===r||void 0===r?void 0:r.iat)||(null===r||void 0===r?void 0:r.iat)+u.W2<n)&&r}return!1}))},P=function(e){var r=e.user,t=e.guestType,o=(0,i.E)().logout;return(0,n.jsxs)("div",{children:[(0,n.jsxs)("h1",{children:["Your ",t," Profile"]}),(0,n.jsxs)("ul",{children:[(0,n.jsxs)("li",{children:["Name: ","".concat((null===r||void 0===r||r.firstName,null===r||void 0===r?void 0:r.lastName))]}),(0,n.jsxs)("li",{children:["Guest: ","".concat(null===r||void 0===r?void 0:r.partnerFirstName," ").concat(null===r||void 0===r?void 0:r.partnerLastName)]}),(0,n.jsxs)("li",{children:["Email: ",null===r||void 0===r?void 0:r.email]}),(0,n.jsxs)("li",{children:["Address: ",null===r||void 0===r?void 0:r.streetAddress]}),(0,n.jsxs)("li",{children:["Times Visited: ",null===r||void 0===r?void 0:r.websiteVisits]})]}),(0,n.jsx)("div",{children:(0,n.jsxs)("form",{onSubmit:function(e){e.preventDefault(),function(e){var r=O.hashSync(e,10);console.log("hashed:",r)}(e.target[0].value)},children:["String to hash:",(0,n.jsx)("input",{type:"text",placeholder:"pass to hash"})]})}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{onClick:function(){return o()},children:"Log Out"})})]})}}}]);